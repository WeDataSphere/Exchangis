"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _fs = require("fs");

var _path = require("path");

var _generateExports = _interopRequireDefault(require("../../../../utils/generateExports"));

var _constants = require("../../../../utils/constants");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _default(api) {
  api.onGenerateFiles(async () => {
    const coreExports = await api.applyPlugins({
      key: 'addCoreExports',
      type: api.ApplyPluginsType.add,
      initialValue: []
    });
    const fesExportsHook = {}; // repeated definition

    const absoluteFilePath = 'core/coreExports.js';
    const content = `${coreExports.map(item => (0, _generateExports.default)(absoluteFilePath, {
      item,
      fesExportsHook
    })).join('\n')}\n`;
    const tpl = (0, _fs.readFileSync)((0, _path.join)(__dirname, './coreExports.tpl'), 'utf-8');
    api.writeTmpFile({
      path: absoluteFilePath,
      content: tpl.replace('CORE_EXPORTS', content).replace('RUNTIME_PATH', _constants.runtimePath)
    });
  });
}