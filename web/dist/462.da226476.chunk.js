"use strict";(self["webpackChunk_fesjs_template"]=self["webpackChunk_fesjs_template"]||[]).push([[462],{89462:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ls});t(66992),t(33948);var a=t(1089),n=t(91706),o=t(56485),i=t(72447),r=t.n(i),l=e=>((0,a.dD)("data-v-15ff1577"),e=e(),(0,a.Cn)(),e),c={class:"container jd-container"},d={class:"tools-bar"},u=(0,a.Uk)("配置"),p=l((()=>(0,a._)("div",{class:"divider"},null,-1))),g=(0,a.Uk)("执行"),b=(0,a.Uk)("停止"),k=l((()=>(0,a._)("div",{class:"divider"},null,-1))),h=(0,a.Uk)("保存"),m=l((()=>(0,a._)("div",{class:"divider"},null,-1))),f=(0,a.Uk)("执行历史"),v={key:0,class:"jd-content"},j={class:"jd_left"},I={class:"left-wrap"},T=l((()=>(0,a._)("div",{class:"sub-title"},[(0,a._)("span",null,"子任务列表")],-1))),y={class:"task-title"},S=["title","onClick"],w=["title","onClick"],C=["onClick"],_=["title","onClick"],x=(0,a.Uk)("添加子任务 "),D={class:"jd_right"},P={key:1,class:"cardWrap"},E={class:"emptyTab"},O={class:"void-page-wrap"},U={class:"void-page-main"},W=l((()=>(0,a._)("div",{class:"void-page-main-img"},[(0,a._)("img",{src:r(),alt:"空页面"})],-1))),F=l((()=>(0,a._)("div",{class:"void-page-main-title"},[(0,a._)("span",null,"该任务下没有子任务，请先创建一个子任务")],-1))),M={class:"void-page-main-button"},Z={class:"jd-bottom"},J={class:"jd-bottom-top"},N=l((()=>(0,a._)("span",null,"执行历史",-1))),z={class:"jd-bottom-content"},q={class:"jd-bottom jd-bottom-log"},R={class:"jd-bottom-top jd-bottom-log-top"},H={class:"jd-bottom-content log-bottom-content"},K={key:0,class:"job-progress-percent job-progress-wrap"},L=(0,a.Uk)("总进度"),Y={style:{"font-size":"11px",color:"rgba(0,0,0,0.5)"}},A={key:1,class:"job-progress-wrap"},V=l((()=>(0,a._)("span",{class:"job-progress-title"},"正在运行",-1))),$={class:"job-progress-body"},B={class:"job-progress-percent"},G=["onClick"],Q=["title","onClick"],X={key:2,class:"job-progress-wrap"},ee=l((()=>(0,a._)("span",{class:"job-progress-title"},"准备中",-1))),se={class:"job-progress-body"},te={class:"job-progress-percent"},ae=["title"],ne={key:3,class:"job-progress-wrap"},oe=l((()=>(0,a._)("span",{class:"job-progress-title"},"初始化",-1))),ie={class:"job-progress-body"},re={class:"job-progress-percent"},le=["title"],ce={key:4,class:"job-progress-wrap"},de=l((()=>(0,a._)("span",{class:"job-progress-title",style:{color:"#ff4d4f"}},"失败",-1))),ue={class:"job-progress-body"},pe={class:"job-progress-percent"},ge=["onClick"],be=["title","onClick"],ke={key:5,class:"job-progress-wrap"},he=l((()=>(0,a._)("span",{class:"job-progress-title",style:{color:"#ff4d4f"}},"终止",-1))),me={class:"job-progress-body"},fe={class:"job-progress-percent"},ve=["onClick"],je=["title","onClick"],Ie={key:6,class:"job-progress-wrap"},Te=l((()=>(0,a._)("span",{class:"job-progress-title"},"成功",-1))),ye={class:"job-progress-body"},Se={class:"job-progress-percent"},we=["onClick"],Ce=["title","onClick"];function _e(e,s,t,i,r,l){var _e=(0,a.up)("SettingOutlined"),xe=(0,a.up)("CaretRightOutlined"),De=(0,a.up)("StopFilled"),Pe=(0,a.up)("a-popconfirm"),Ee=(0,a.up)("SaveOutlined"),Oe=(0,a.up)("HistoryOutlined"),Ue=(0,a.up)("a-input"),We=(0,a.up)("DeleteOutlined"),Fe=(0,a.up)("CopyOutlined"),Me=(0,a.up)("EditOutlined"),Ze=(0,a.up)("ArrowDownOutlined"),Je=(0,a.up)("PlusOutlined"),Ne=(0,a.up)("a-button"),ze=(0,a.up)("DataSource"),qe=(0,a.up)("FieldMap"),Re=(0,a.up)("ProcessControl"),He=(0,a.up)("a-spin"),Ke=(0,a.up)("CloseOutlined"),Le=(0,a.up)("a-table"),Ye=(0,a.up)("a-progress"),Ae=(0,a.up)("a-tooltip"),Ve=(0,a.up)("RightOutlined"),$e=(0,a.up)("DownOutlined"),Be=(0,a.up)("metrics"),Ge=(0,a.up)("a-tab-pane"),Qe=(0,a.up)("execution-log"),Xe=(0,a.up)("router-link"),es=(0,a.up)("a-tabs"),ss=(0,a.up)("config-modal"),ts=(0,a.up)("copy-modal");return(0,a.wg)(),(0,a.iD)("div",c,[(0,a._)("div",d,[(0,a._)("span",{onClick:s[0]||(s[0]=e=>r.modalCfg.visible=!0)},[(0,a.Wm)(_e),u]),p,r.spinning?((0,a.wg)(),(0,a.j4)(Pe,{key:1,title:"是否终止?","ok-text":"确定","cancel-text":"取消",onConfirm:l.killTask,onCancel:l.cancel},{default:(0,a.w5)((()=>[(0,a._)("span",null,[(0,a.Wm)(De,{style:{color:"#ff4d4f"}}),b])])),_:1},8,["onConfirm","onCancel"])):((0,a.wg)(),(0,a.iD)("span",{key:0,onClick:s[1]||(s[1]=function(){return l.executeTask&&l.executeTask(...arguments)})},[(0,a.Wm)(xe),g])),k,(0,a._)("span",{onClick:s[2]||(s[2]=e=>l.saveAll())},[(0,a.Wm)(Ee),h]),m,(0,a._)("span",{onClick:s[3]||(s[3]=function(){return l.executeHistory&&l.executeHistory(...arguments)})},[(0,a.Wm)(Oe),f])]),0!==r.list.length?((0,a.wg)(),(0,a.iD)("div",v,[(0,a.Wm)(He,{size:"large",spinning:r.loading,wrapperClassName:"wrap-spin"},{default:(0,a.w5)((()=>[(0,a._)("div",j,[(0,a._)("div",I,[T,((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.list,((e,t)=>((0,a.wg)(),(0,a.iD)("div",{key:t,class:(0,n.C_)(l.getClass(t))},[(0,a._)("div",y,[r.activeIndex!==t||r.activeIndex===t&&!r.nameEditable?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"subjobName",title:e.subJobName,onClick:e=>l.changeCurTask(t)},(0,n.zw)(e.subJobName),9,S)):(0,a.kq)("",!0),r.activeIndex===t&&r.nameEditable?((0,a.wg)(),(0,a.j4)(Ue,{key:1,ref_for:!0,ref:"currentInput",value:e.subJobName,"onUpdate:value":s=>e.subJobName=s,style:{width:"115px"},onPressEnter:s[4]||(s[4]=e=>r.nameEditable=!1),onBlur:s[5]||(s[5]=e=>r.nameEditable=!1)},null,8,["value","onUpdate:value"])):(0,a.kq)("",!0),(0,a.Wm)(Pe,{title:"是否删除子任务?","ok-text":"确定","cancel-text":"取消",onConfirm:e=>l.deleteSub(t),onCancel:l.cancel},{default:(0,a.w5)((()=>[(0,a.Wm)(We,{title:"删除",class:"delete-icon"})])),_:2},1032,["onConfirm","onCancel"]),(0,a.Wm)(Pe,{title:"是否复制子任务?","ok-text":"确定","cancel-text":"取消",onConfirm:s=>l.copySub(e),onCancel:l.cancel},{default:(0,a.w5)((()=>[(0,a.Wm)(Fe,{title:"复制",class:"copy-icon"})])),_:2},1032,["onConfirm","onCancel"]),r.activeIndex!==t||r.nameEditable?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(Me,{key:2,class:"rename-icon",onClick:l.getEditableInput},null,8,["onClick"]))]),e.dataSourceIds&&e.dataSourceIds.source&&e.dataSourceIds.source.db?((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a._)("div",{class:"sub-table",title:e.dataSourceIds.source.db+"."+e.dataSourceIds.source.table,onClick:e=>l.changeCurTask(t)},(0,n.zw)(e.dataSourceIds.source.db+"."+e.dataSourceIds.source.table),9,w),(0,a._)("div",{class:"arrow-down-icon",onClick:e=>l.changeCurTask(t)},[(0,a.Wm)(Ze)],8,C),(0,a._)("div",{class:"sub-table",title:e.dataSourceIds.sink.db+"."+e.dataSourceIds.sink.table,onClick:e=>l.changeCurTask(t)},(0,n.zw)(e.dataSourceIds.sink.db+"."+e.dataSourceIds.sink.table),9,_)],64)):(0,a.kq)("",!0)],2)))),128))]),(0,a.Wm)(Ne,{size:"large",style:{width:"218px","font-family":"PingFangSC-Regular","font-size":"14px","line-height":"22px","font-weight":"400",border:"1px dashed #dee4ec",margin:"0 15px"},onClick:l.addNewTask},{icon:(0,a.w5)((()=>[(0,a.Wm)(Je)])),default:(0,a.w5)((()=>[x])),_:1},8,["onClick"])]),(0,a._)("div",D,[(0,a._)("div",null,[r.curTask?((0,a.wg)(),(0,a.j4)(ze,{key:0,dsData:r.curTask,engineType:r.curTask.engineType,onUpdateSourceInfo:l.updateSourceInfo,onUpdateSinkInfo:l.updateSinkInfo,onUpdateSourceParams:l.updateSourceParams,onUpdateSinkParams:l.updateSinkParams},null,8,["dsData","engineType","onUpdateSourceInfo","onUpdateSinkInfo","onUpdateSourceParams","onUpdateSinkParams"])):(0,a.kq)("",!0)]),(0,a._)("div",null,[r.curTask?((0,a.wg)(),(0,a.j4)(qe,{key:0,fmData:r.curTask.transforms,fieldsSink:r.fieldsSink,fieldsSource:r.fieldsSource,deductions:r.deductions,addEnabled:r.addEnable,engineType:r.curTask.engineType,onUpdateFieldMap:l.updateFieldMap},null,8,["fmData","fieldsSink","fieldsSource","deductions","addEnabled","engineType","onUpdateFieldMap"])):(0,a.kq)("",!0)]),(0,a._)("div",null,[r.curTask?((0,a.wg)(),(0,a.j4)(Re,{key:0,psData:r.curTask.settings,engineType:r.curTask.engineType,onUpdateProcessControl:l.updateProcessControl},null,8,["psData","engineType","onUpdateProcessControl"])):(0,a.kq)("",!0)])])])),_:1},8,["spinning"])])):(0,a.kq)("",!0),0===r.list.length?((0,a.wg)(),(0,a.iD)("div",P,[(0,a.Wm)(He,{spinning:r.loading},{default:(0,a.w5)((()=>[(0,a._)("div",E,[(0,a._)("div",O,[(0,a._)("div",U,[W,F,(0,a._)("div",M,[(0,a.Wm)(Ne,{type:"primary",size:"large",style:{"font-family":"PingFangSC-Regular","font-size":"14px","line-height":"22px","font-weight":"400"},onClick:l.addNewTask},{icon:(0,a.w5)((()=>[(0,a.Wm)(Je)])),default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(r.t("job.action.createJob")),1)])),_:1},8,["onClick"])])])])])])),_:1},8,["spinning"])])):(0,a.kq)("",!0),(0,a.wy)((0,a._)("div",Z,[(0,a._)("div",J,[N,(0,a.Wm)(Ke,{style:{color:"rgba(0, 0, 0, 0.45)","font-size":"12px",position:"absolute",right:"24px",top:"18px",cursor:"pointer"},onClick:l.onCloseDrawer},null,8,["onClick"])]),(0,a._)("div",z,[(0,a.Wm)(Le,{columns:r.ehColumns,"data-source":r.ehTableData,pagination:r.ehPagination,onChange:l.onPageChange},null,8,["columns","data-source","pagination","onChange"])])],512),[[o.vShow,r.visibleDrawer]]),(0,a.wy)((0,a._)("div",q,[(0,a._)("div",R,[(0,a.Wm)(Ke,{style:{color:"rgba(0, 0, 0, 0.45)","font-size":"12px",position:"absolute",right:"24px",top:"18px",cursor:"pointer"},onClick:l.onCloseLog},null,8,["onClick"])]),(0,a._)("div",H,[(0,a.Wm)(es,{activeKey:r.activeKey,"onUpdate:activeKey":s[6]||(s[6]=e=>r.activeKey=e),class:"exec-info-tab"},{default:(0,a.w5)((()=>[(0,a.Wm)(Ge,{key:"1",tab:"运行情况"},{default:(0,a.w5)((()=>[r.jobProgress.tasks?((0,a.wg)(),(0,a.iD)("div",K,[(0,a._)("span",null,[L,(0,a._)("span",Y,"("+(0,n.zw)(r.statusMap[r.jobStatus])+")",1)]),(0,a.Wm)(Ae,{title:r.jobProgress.title},{default:(0,a.w5)((()=>[r.jobProgress.failedTasks?((0,a.wg)(),(0,a.j4)(Ye,{key:0,percent:r.jobProgress.percent,status:"exception"},null,8,["percent"])):((0,a.wg)(),(0,a.j4)(Ye,{key:1,percent:r.jobProgress.percent},null,8,["percent"]))])),_:1},8,["title"])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Running?((0,a.wg)(),(0,a.iD)("div",A,[V,(0,a._)("div",$,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Running,((e,s)=>((0,a.wg)(),(0,a.iD)("div",B,[(0,a._)("span",{class:"job-progress-expand-icon",onClick:s=>l.getTaskInfo(e)},[r.openMetricsId!==e.taskId?((0,a.wg)(),(0,a.j4)(Ve,{key:0})):((0,a.wg)(),(0,a.j4)($e,{key:1}))],8,G),(0,a._)("span",{title:e.name,style:{color:"#2e92f7",cursor:"pointer"},onClick:s=>l.getTaskInfo(e)},(0,n.zw)(e.name),9,Q),(0,a.Wm)(Ye,{percent:100*e.progress},null,8,["percent"]),r.openMetricsId===e.taskId&&r.metricsInfo[e.taskId]?((0,a.wg)(),(0,a.j4)(Be,{key:0,metricsInfo:r.metricsInfo,progress:e,style:{"margin-left":"100px"}},null,8,["metricsInfo","progress"])):(0,a.kq)("",!0)])))),256))])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Scheduled?((0,a.wg)(),(0,a.iD)("div",X,[ee,(0,a._)("div",se,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Scheduled,((e,s)=>((0,a.wg)(),(0,a.iD)("div",te,[(0,a._)("span",{title:e.name},(0,n.zw)(e.name),9,ae),(0,a.Wm)(Ye,{percent:0})])))),256))])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Inited?((0,a.wg)(),(0,a.iD)("div",ne,[oe,(0,a._)("div",ie,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Inited,((e,s)=>((0,a.wg)(),(0,a.iD)("div",re,[(0,a._)("span",{title:e.name},(0,n.zw)(e.name),9,le),(0,a.Wm)(Ye,{percent:0})])))),256))])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Failed?((0,a.wg)(),(0,a.iD)("div",ce,[de,(0,a._)("div",ue,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Failed,((e,s)=>((0,a.wg)(),(0,a.iD)("div",pe,[(0,a._)("span",{class:"job-progress-expand-icon",onClick:s=>l.getTaskInfo(e)},[r.openMetricsId!==e.taskId?((0,a.wg)(),(0,a.j4)(Ve,{key:0})):((0,a.wg)(),(0,a.j4)($e,{key:1}))],8,ge),(0,a._)("span",{title:e.name,style:{color:"#2e92f7",cursor:"pointer"},onClick:s=>l.getTaskInfo(e)},(0,n.zw)(e.name),9,be),(0,a.Wm)(Ye,{percent:100*e.progress},null,8,["percent"]),r.openMetricsId===e.taskId&&r.metricsInfo[e.taskId]?((0,a.wg)(),(0,a.j4)(Be,{key:0,metricsInfo:r.metricsInfo,progress:e,style:{"margin-left":"100px"}},null,8,["metricsInfo","progress"])):(0,a.kq)("",!0)])))),256))])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Cancelled?((0,a.wg)(),(0,a.iD)("div",ke,[he,(0,a._)("div",me,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Cancelled,((e,s)=>((0,a.wg)(),(0,a.iD)("div",fe,[(0,a._)("span",{class:"job-progress-expand-icon",onClick:s=>l.getTaskInfo(e)},[r.openMetricsId!==e.taskId?((0,a.wg)(),(0,a.j4)(Ve,{key:0})):((0,a.wg)(),(0,a.j4)($e,{key:1}))],8,ve),(0,a._)("span",{title:e.name,style:{color:"#2e92f7",cursor:"pointer"},onClick:s=>l.getTaskInfo(e)},(0,n.zw)(e.name),9,je),(0,a.Wm)(Ye,{percent:100*e.progress},null,8,["percent"]),r.openMetricsId===e.taskId&&r.metricsInfo[e.taskId]?((0,a.wg)(),(0,a.j4)(Be,{key:0,metricsInfo:r.metricsInfo,progress:e,style:{"margin-left":"100px"}},null,8,["metricsInfo","progress"])):(0,a.kq)("",!0)])))),256))])])):(0,a.kq)("",!0),r.jobProgress.tasks&&r.jobProgress.tasks.Success?((0,a.wg)(),(0,a.iD)("div",Ie,[Te,(0,a._)("div",ye,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.jobProgress.tasks.Success,((e,s)=>((0,a.wg)(),(0,a.iD)("div",Se,[(0,a._)("span",{class:"job-progress-expand-icon",onClick:s=>l.getTaskInfo(e)},[r.openMetricsId!==e.taskId?((0,a.wg)(),(0,a.j4)(Ve,{key:0})):((0,a.wg)(),(0,a.j4)($e,{key:1}))],8,we),(0,a._)("span",{title:e.name,style:{color:"#2e92f7",cursor:"pointer"},onClick:s=>l.getTaskInfo(e)},(0,n.zw)(e.name),9,Ce),(0,a.Wm)(Ye,{percent:100*e.progress},null,8,["percent"]),r.openMetricsId===e.taskId&&r.metricsInfo[e.taskId]?((0,a.wg)(),(0,a.j4)(Be,{key:0,metricsInfo:r.metricsInfo,progress:e,style:{"margin-left":"100px"}},null,8,["metricsInfo","progress"])):(0,a.kq)("",!0)])))),256))])])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(Ge,{key:"2",tab:"实时日志","force-render":""},{default:(0,a.w5)((()=>[(0,a.Wm)(Qe,{param:l.logParams,isShow:r.visibleLog},null,8,["param","isShow"])])),_:1}),(0,a.Wm)(Ge,{key:"3",tab:"执行历史","force-render":""},{default:(0,a.w5)((()=>[(0,a.Wm)(Le,{style:{margin:"0 0 0 24px"},columns:r.ehColumns,"data-source":r.ehTableData,pagination:!1,scroll:{y:240}},{jobExecutionId:(0,a.w5)((e=>{var s=e.record;return[(0,a.Wm)(Xe,{to:"/synchronizationHistory?jobExecutionId=".concat(s.jobExecutionId)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,n.zw)(s.jobExecutionId),1)])),_:2},1032,["to"])]})),status:(0,a.w5)((e=>{var s=e.record;return[(0,a._)("span",null,(0,n.zw)(r.statusMap[s.status]),1)]})),createTime:(0,a.w5)((e=>{var s=e.record;return[(0,a._)("span",null,(0,n.zw)(r.dateFormat(s.createTime)),1)]})),_:1},8,["columns","data-source"])])),_:1})])),_:1},8,["activeKey"])])],512),[[o.vShow,r.visibleLog]]),(0,a.Wm)(ss,{id:r.modalCfg.id,visible:r.modalCfg.visible,"onUpdate:visible":s[7]||(s[7]=e=>r.modalCfg.visible=e),formData:r.configModalData,onFinish:l.handleModalFinish},null,8,["id","visible","formData","onFinish"]),(0,a.Wm)(ts,{visible:r.modalCopy.visible,"onUpdate:visible":s[8]||(s[8]=e=>r.modalCopy.visible=e),origin:r.copyObj,onFinish:l.handleModalCopy},null,8,["visible","origin","onFinish"])])}t(26690);var xe=t(73309),De=(t(86778),t(25318)),Pe=t(15861),Ee=t(87757),Oe=t.n(Ee),Ue=(t(41539),t(54747),t(92222),t(88674),t(19601),t(40561),t(47042),t(21249),t(2707),t(82772),t(74670)),We=t(38742),Fe=t(50351),Me=t(97848),Ze=t(85547),Je=t(99539),Ne=t(37002),ze=t(26411),qe=t(42255),Re=t(41289),He=t(10784),Ke=t(61696),Le=t(63467),Ye=t(94638),Ae=t(92487),Ve=t(74775),$e=t(81491),Be=t(4242),Ge=t(36159),Qe=t(23746),Xe=t(91438),es=t(92037),ss=t(47059),ts=e=>{var s=!1;return Object.keys(e).forEach((t=>{null!=e[t]&&""!=e[t]&&void 0!=e[t]||(s=!0)})),s},as=e=>{var s=new Date(e),t="".concat(s.getFullYear(),"-"),a="".concat(s.getMonth()+1<10?"0".concat(s.getMonth()+1):s.getMonth()+1,"-"),n=s.getDate()<10?"0".concat(s.getDate()):s.getDate(),o="".concat(s.getHours()<10?"0".concat(s.getHours()):s.getHours(),":"),i="".concat(s.getMinutes()<10?"0".concat(s.getMinutes()):s.getMinutes(),":"),r=s.getSeconds()<10?"0".concat(s.getSeconds()):s.getSeconds();return"".concat(t+a+n," ").concat(o).concat(i).concat(r)},ns=[{title:"编号",dataIndex:"key",align:"center"},{title:"执行ID",dataIndex:"jobExecutionId",slots:{customRender:"jobExecutionId"},align:"center"},{title:"状态",dataIndex:"status",slots:{customRender:"status"},align:"center"},{title:"创建时间",dataIndex:"createTime",slots:{customRender:"createTime"},align:"center"}];const os={components:{SettingOutlined:We.Z,CaretRightOutlined:Fe.Z,SaveOutlined:Me.Z,HistoryOutlined:Ze.Z,DatabaseFilled:Je.Z,PlusSquareOutlined:Ne.Z,CopyOutlined:ze.Z,DeleteOutlined:qe.Z,ArrowDownOutlined:Re.Z,CheckCircleOutlined:He.Z,EditOutlined:Ke.Z,PlusOutlined:Le.Z,DownOutlined:Ye.Z,RightOutlined:Ae.Z,"config-modal":(0,a.RC)((()=>t.e(447).then(t.bind(t,93447)))),"copy-modal":(0,a.RC)((()=>t.e(742).then(t.bind(t,12742)))),DataSource:(0,a.RC)((()=>t.e(246).then(t.bind(t,79246)))),FieldMap:(0,a.RC)((()=>t.e(947).then(t.bind(t,99947)))),ProcessControl:(0,a.RC)((()=>t.e(727).then(t.bind(t,64727)))),MinusOutlined:Ve.Z,CloseOutlined:$e.Z,StopFilled:Be.Z,executionLog:es.Z,metrics:ss.Z},props:{curTab:Object},data(){var e=(0,Ge.QT)({useScope:"global"}),s=e.t;return{loading:!1,name:"",modalCfg:{id:"",visible:!1},modalCopy:{visible:!1},jobData:{},copyObj:{},list:[],activeIndex:-1,curTask:null,nameEditable:!1,fieldsSource:[],fieldsSink:[],deductions:[],addEnable:!1,configModalData:{},visibleDrawer:!1,visibleLog:!1,pageSize:10,currentPage:1,ehColumns:ns,ehTableData:[],ehPagination:{total:0,pageSize:10},t:s,spinning:!1,logs:{logs:["","","",""]},executeId:"",jobExecutionId:"",jobStatus:"",allTaskStatus:"",jobStatusTimer:null,tasklist:[],progressTimer:null,jobProgress:{},metricsInfo:{},openMetricsId:"",statusMap:{Inited:"初始化",Scheduled:"准备",Running:"运行",WaitForRetry:"等待重试",Cancelled:"取消",Failed:"失败",Partial_Success:"部分成功",Success:"成功",Undefined:"未定义",Timeout:"超时"},activeKey:"1",dateFormat:Xe.vc}},computed:{logParams(){return{list:this.tasklist,id:this.jobExecutionId}}},watch:{curTab(e,s){e&&s&&e.id!==s.id&&this.init()}},created(){this.init()},beforeUnmount(){clearInterval(this.jobStatusTimer),clearInterval(this.progressTimer)},methods:{init(){this.name=this.curTab.jobName,this.getInfo()},getInfo(){var e=this;return(0,Pe.Z)(Oe().mark((function s(){var t,a;return Oe().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,e.loading=!0,s.next=4,(0,Qe.Z7)(e.curTab.id);case 4:t=s.sent.result,e.loading=!1,t.content&&"[]"!==t.content?t.content=JSON.parse(t.content):t.content={subJobs:[]},t.content.subJobs.forEach((e=>{e.engineType=t.engineType})),e.jobData=t,a=Object.create(null),a.executeNode=t.executeNode||"",a.proxyUser=t.proxyUser||"",a.syncType=t.syncType||"",a.jobParams=JSON.parse(t.jobParams),e.configModalData=a,e.list=e.jobData.content.subJobs,e.list.length&&(e.activeIndex=0,e.curTask=e.list[e.activeIndex],e.addEnable=e.curTask.transforms.addEnable,e.updateSourceInfo(e.curTask)),s.next=22;break;case 19:s.prev=19,s.t0=s["catch"](0),e.loading=!1;case 22:case"end":return s.stop()}}),s,null,[[0,19]])})))()},handleModalFinish(e){var s=this,t=this.curTab.id,a=Object.assign({},JSON.parse(JSON.stringify((0,Ue.IU)(e))));if(a.jobParams){var n=Object.create(null);a.jobParams.forEach((e=>{n[e.key]=e.value})),a.jobParams=JSON.stringify(n)}(0,Qe.NB)(t,a).then((e=>{De.Z.success("更新/保存成功"),s.jobData.proxyUser=a.proxyUser})).catch((e=>{De.Z.error("更新/保存失败"),console.log("updateTaskConfiguration error",e)}))},handleModalCopy(e){e&&this.jobData.content.subJobs.push(e)},copySub(e){this.copyObj=e,this.modalCopy.visible=!0},deleteSub(e){this.jobData.content.subJobs.splice(e,1),this.activeIndex===e&&this.list.length?(this.activeIndex=0,this.curTask=this.list[this.activeIndex],this.addEnable=this.curTask.transforms.addEnable):(this.activeIndex=-1,this.curTask=null,this.addEnable=!1)},cancel(){},getClass(e){return this.activeIndex===e?"sub-content active":"sub-content"},changeCurTask(e){this.activeIndex=e,this.curTask=this.list[this.activeIndex],this.addEnable=this.curTask.transforms.addEnable;var s=this.getFieldsParams(this.curTask);s&&(0,Qe.VN)(s).then((e=>{})).catch((e=>{console.log(e)}))},addNewTask(){var e=(0,Xe.O1)(12),s={subJobName:e,engineType:this.jobData.engineType,dataSourceIds:{source:{type:"",id:"",db:"",table:"",ds:""},sink:{type:"",id:"",db:"",table:"",ds:""}},params:{sources:[],sinks:[]},transforms:{type:"MAPPING",mapping:[]},settings:[]};(0,Qe.FX)(this.jobData.engineType).then((e=>{e.ui.forEach((e=>{!e.value&&e.defaultValue&&(e.value=e.defaultValue)})),s.settings=e.ui||[],this.jobData.content.subJobs.push(s),this.$nextTick((()=>{this.activeIndex=this.jobData.content.subJobs.length-1,this.curTask=this.list[this.activeIndex],this.addEnable=!1,this.deductions=[]}))}))},updateFieldMap(e){this.curTask.transforms=e},updateProcessControl(e){this.curTask.settings=e},getFieldsParams(e){var s=e.dataSourceIds,t=e.params;this.curTask.dataSourceIds=s,this.curTask.params=t;var a=this.curTask.dataSourceIds.source,n=this.curTask.dataSourceIds.sink;return a.type&&a.id&&n.type&&n.id?{sourceTypeId:a.type,sourceDataSourceId:a.id,sourceDataBase:a.db,sourceTable:a.table,sinkTypeId:n.type,sinkDataSourceId:n.id,sinkDataBase:n.db,sinkTable:n.table,engine:this.jobData.engineType}:null},convertDeductions(e){var s=[];return e.forEach((e=>{var t={},a=e.source,n=e.sink;t.sink_field_name=n.name,t.sink_field_type=n.type,t.sink_field_index=n.fieldIndex,t.sink_field_editable=n.fieldEditable,t.deleteEnable=e.deleteEnable,t.source_field_name=a.name,t.source_field_type=a.type,t.source_field_index=a.fieldIndex,t.source_field_editable=a.fieldEditable,s.push(t)})),s},updateSourceInfo(e,s){var t=this.getFieldsParams(e);t?(0,Qe.VN)(t).then((e=>{this.fieldsSource=e.sourceFields,this.fieldsSink=e.sinkFields,this.deductions=e.deductions,this.addEnable=e.addEnable,s&&this.curTask.transforms.mapping&&this.curTask.transforms.mapping.length||(this.curTask.transforms.mapping=this.convertDeductions(e.deductions))})):(this.fieldsSource=[],this.fieldsSink=[],this.deductions=[],this.addEnable=!1,this.curTask.transforms.mapping=[])},updateSinkInfo(e,s){var t=this.getFieldsParams(e);t?(0,Qe.VN)(t).then((e=>{this.fieldsSource=e.sourceFields,this.fieldsSink=e.sinkFields,this.deductions=e.deductions,this.addEnable=e.addEnable,s&&this.curTask.transforms.mapping&&this.curTask.transforms.mapping.length||(this.curTask.transforms.mapping=this.convertDeductions(e.deductions))})):(this.fieldsSource=[],this.fieldsSink=[],this.deductions=[],this.addEnable=!1,this.curTask.transforms.mapping=[])},updateSourceParams(e){var s=e.params;this.curTask.params=s},updateSinkParams(e){var s=e.params;this.curTask.params=s},checkPostData(e){var s=[],t=e.proxyUser,a=e.content,n=a.subJobs.slice();return t||s.push("配置任务中执行用户不可为空"),n.forEach((e=>{var t=e.params,a=e.settings;for(var n in t)t[n].forEach((e=>{!e.value&&e.required&&s.push("".concat(e.label,"不可为空"))}));a.forEach((e=>{!e.value&&e.required&&s.push("".concat(e.label,"不可为空"))}))})),s},saveAll(e){var s=this,t=[],n=(0,Ue.IU)(this.jobData),o=this.checkPostData(n);if(o.length>0)return xe.Z.warning({message:"任务信息未完整填写",description:(0,a.h)("ul",{},o.map((e=>(0,a.h)("li",{},e)))),duration:5});if(!n.content||!n.content.subJobs)return De.Z.error("缺失保存对象");for(var i=function(e){var a=(0,Ue.IU)(n.content.subJobs[e]),o={};if(o.subJobName=a.subJobName,!a.dataSourceIds||ts(a.dataSourceIds.source)||ts(a.dataSourceIds.sink))return{v:De.Z.error("未选择数据源库表")};o.dataSources={source_id:"".concat(a.dataSourceIds.source.type,".").concat(a.dataSourceIds.source.id,".").concat(a.dataSourceIds.source.db,".").concat(a.dataSourceIds.source.table),sink_id:"".concat(a.dataSourceIds.sink.type,".").concat(a.dataSourceIds.sink.id,".").concat(a.dataSourceIds.sink.db,".").concat(a.dataSourceIds.sink.table)},o.params={sources:[],sinks:[]},a.params.sources.forEach((e=>{o.params.sources.push({config_key:e.field,config_name:e.label,config_value:e.value,sort:e.sort})})),a.params.sinks.forEach((e=>{o.params.sinks.push({config_key:e.field,config_name:e.label,config_value:e.value,sort:e.sort})})),o.transforms=a.transforms,o.transforms.addEnable=s.addEnable,o.settings=[],a.settings&&a.settings.length&&a.settings.forEach((e=>{o.settings.push({config_key:e.field,config_name:e.label,config_value:e.value,sort:e.sort})})),t.push(o)},r=0;r<n.content.subJobs.length;r++){var l=i(r);if("object"===typeof l)return l.v}(0,Qe.UI)(this.jobData.id,{content:JSON.stringify(t)}).then((s=>{e&&e(),De.Z.success("保存成功")}))},executeTask(){if(!this.list.length)return De.Z.error("没有子任务");this.saveAll((()=>{var e=this.curTab.id;this.tasklist=[],this.spinning=!0,(0,Qe.fL)(e).then((e=>{this.jobExecutionId=e.jobExecutionId,this.visibleLog=!0,(0,Xe.fs)(".jd-bottom-log",".jd-container",".jd-bottom-log-top"),this.getStatus(e.jobExecutionId),this.ehTableData.push({jobExecutionId:this.jobExecutionId,createTime:(new Date).getTime(),status:"",key:this.ehTableData.length+1})})).catch((e=>{console.log(e),this.spinning=!1,De.Z.error("执行失败")}))}))},killTask(){if(!this.jobStatus)return De.Z.error("正在等待");(0,Qe.UY)(this.jobExecutionId).then((e=>{this.spinning=!1,clearInterval(this.jobStatusTimer),clearInterval(this.progressTimer),this.visibleLog=!1,this.jobStatus="Cancelled";for(var s=this.ehTableData.length;s>0;s--){var t=this.ehTableData[s-1];if(t.jobExecutionId===this.jobExecutionId){t.status="Cancelled";break}}})).catch((e=>{console.log(e),this.spinning=!1,De.Z.error("停止失败")}))},getStatus(e){this.getStatusInvoke(e),this.jobStatusTimer=setInterval((()=>{this.getStatusInvoke(e)}),5e3)},getStatusInvoke(e){var s=["Inited","Scheduled","Running","WaitForRetry"];(0,Qe.jW)(e).then((t=>{this.jobStatus=t.status,this.allTaskStatus=t.allTaskStatus;for(var a=this.ehTableData.length;a>0;a--){var n=this.ehTableData[a-1];if(n.jobExecutionId===e){n.status=t.status;break}}this.tasklist.length||this.getTasks(e,!0),-1===s.indexOf(this.jobStatus)&&this.allTaskStatus&&(this.spinning=!1,clearInterval(this.jobStatusTimer),setTimeout((()=>{clearInterval(this.progressTimer)}),5e3))})).catch((e=>{De.Z.error("查询job状态失败")}))},getTasks(e,s){(0,Qe.vT)(e).then((t=>{this.tasklist=t.tasks,s&&this.getJobProgress(e)})).catch((e=>{De.Z.error("查询任务列表失败")}))},getJobProgress(e){this.getJobProgressInvoke(e),clearInterval(this.progressTimer),this.progressTimer=setInterval((()=>{this.getJobProgressInvoke(e)}),5e3)},getJobProgressInvoke(e){(0,Qe.xC)(e).then((s=>{var t,a,n,o,i,r;s.job&&s.job.tasks&&(s.job.successTasks=(null===(t=s.job.tasks.Success)||void 0===t?void 0:t.length)||0,s.job.initedTasks=(null===(a=s.job.tasks.Inited)||void 0===a?void 0:a.length)||0,s.job.runningTasks=(null===(n=s.job.tasks.Running)||void 0===n?void 0:n.length)||0,s.job.failedTasks=(null===(o=s.job.tasks.Failed)||void 0===o?void 0:o.length)||0,s.job.cancelledTasks=(null===(i=s.job.tasks.Cancelled)||void 0===i?void 0:i.length)||0,s.job.scheduledTasks=(null===(r=s.job.tasks.Scheduled)||void 0===r?void 0:r.length)||0,s.job.totalTasks=this.tasklist.length,s.job.total&&s.job.total!==this.tasklist.length&&(s.job.totalTasks=s.job.total,this.getTasks(e)),s.job.successPercent=100*s.job.successTasks/s.job.totalTasks,s.job.percent=100*s.job.progress,s.job.title=s.job.failedTasks?"".concat(s.job.failedTasks,"失败,").concat(s.job.successTasks,"成功,").concat(s.job.runningTasks,"正在运行,").concat(s.job.scheduledTasks,"正在准备"):"".concat(s.job.successTasks,"成功,").concat(s.job.runningTasks,"正在运行,").concat(s.job.scheduledTasks,"正在准备"));this.jobProgress=s.job})).catch((e=>{De.Z.error("查询进度失败")}))},getTaskInfo(e){this.openMetricsId!==e.taskId?(this.openMetricsId=e.taskId,(0,Qe.Kt)(e.taskId,this.jobExecutionId).then((s=>{var t;s.task.taskId=e.taskId,this.metricsInfo[s.task.taskId]=null===(t=s.task)||void 0===t?void 0:t.metrics})).catch((e=>{De.Z.error("查询任务指标失败")}))):this.openMetricsId=""},executeHistory(){this.visibleLog=!0,this.activeKey="3"},getTableFormCurrent(e,s){var t=this;if(!(t.ehTableData.length==t.ehPagination.total&&t.ehPagination.total>0&&"search"!==s)&&(t.currentPage!=e||"search"===s)){var a=t.curTab.id||"",n=t.pageSize;(0,Qe.PO)({jobId:a,current:e,size:n}).then((e=>{if(e.result.length>0){var a=e.result||[];a.forEach((e=>{switch(e.launchTime=as(e.launchTime),e.completeTime=as(e.completeTime),e.status){case"SUCCESS":e.status="执行成功";break;case"FAILED":e.status="执行失败";break;case"RUNNING":e.status="运行中"}e.key=e.id})),"search"==s&&(t.TableData=[]),t.ehPagination.total=e.total,t.ehTableData=t.ehTableData.concat(a)}})).catch((e=>{console.log("syncHistory error",e)}))}},onPageChange(e){var s=e.current;this.getTableFormCurrent(s,"onChange")},onCloseDrawer(){this.visibleDrawer=!1},onCloseLog(){clearInterval(this.progressTimer),this.visibleLog=!1},getEditableInput(){this.nameEditable=!0,this.$nextTick((()=>{this.$refs.currentInput&&this.$refs.currentInput.focus&&this.$refs.currentInput.focus()}))}}};var is=t(53629);const rs=(0,is.Z)(os,[["render",_e],["__scopeId","data-v-15ff1577"]]),ls=rs}}]);