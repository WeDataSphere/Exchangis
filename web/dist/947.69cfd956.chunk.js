"use strict";(self["webpackChunk_fesjs_template"]=self["webpackChunk_fesjs_template"]||[]).push([[947],{99947:(e,i,l)=>{l.r(i),l.d(i,{default:()=>E});l(66992),l(33948);var a=l(1089),d=l(91706),t=l(56485),r=e=>((0,a.dD)("data-v-5da9c90c"),e=e(),(0,a.Cn)(),e),s={class:"field-map-wrap"},n={class:"fm-r"},o={style:{"margin-right":"8px",color:"rgba(0, 0, 0, 0.45)"}},f=r((()=>(0,a._)("span",null,"字段映射",-1))),p={key:0,style:{"margin-bottom":"15px"}},u=(0,a.Uk)("新增"),c={style:{display:"flex"}},m={class:"filed-map-wrap-l"},y={class:"filed-map-wrap-l-content"},k={class:"field-map-wrap-mid"},v={class:"field-map-wrap-r"},_={class:"field-map-wrap-r-content"};function h(e,i,l,r,h,S){var g=(0,a.up)("RightOutlined"),D=(0,a.up)("DownOutlined"),b=(0,a.up)("a-button"),w=(0,a.up)("a-select"),N=(0,a.up)("a-input"),T=(0,a.up)("a-table"),E=(0,a.up)("Transformer"),x=(0,a.up)("DeleteOutlined");return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",n,[(0,a._)("div",{class:"main-header",onClick:i[0]||(i[0]=function(){return e.showInfo&&e.showInfo(...arguments)})},[(0,a._)("span",o,[e.isFold?((0,a.wg)(),(0,a.j4)(D,{key:1})):((0,a.wg)(),(0,a.j4)(g,{key:0}))]),f]),(0,a.wy)((0,a._)("div",{class:(0,d.C_)(["main-content",{"text-danger":!e.fieldsSource.length&&!e.fieldsSink.length}])},[e.fieldsSource.length&&e.fieldsSink.length&&e.addEnabled?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.Wm)(b,{type:"dashed",onClick:e.addTableRow},{default:(0,a.w5)((()=>[u])),_:1},8,["onClick"])])):(0,a.kq)("",!0),(0,a._)("div",c,[(0,a._)("div",m,[(0,a._)("div",y,["MAPPING"===e.type&&e.fieldMap.sourceDS.length>0?((0,a.wg)(),(0,a.j4)(T,{key:0,dataSource:e.fieldMap.sourceDS,columns:e.columns1,size:"large",pagination:!1,bordered:""},{fieldName:(0,a.w5)((i=>{var l=i.record;return[(0,a.Wm)(w,{ref:"select",value:l.fieldName,style:{width:"150px"},options:l.fieldOptions,onChange:i=>e.updateSourceFieldName(l,i)},null,8,["value","options","onChange"])]})),fieldType:(0,a.w5)((e=>{var i=e.record;return[(0,a.Wm)(N,{value:i.fieldType,style:{width:"150px"},disabled:""},null,8,["value"])]})),_:1},8,["dataSource","columns"])):(0,a.kq)("",!0)])]),(0,a._)("div",k,[(0,a._)("div",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.fieldMap.transformerList,((i,l)=>((0,a.wg)(),(0,a.iD)("div",{key:i.key,style:{position:"relative",height:"65px",float:"left",width:"200px"}},["DATAX"===e.engineType?((0,a.wg)(),(0,a.j4)(E,{key:0,tfData:i,onUpdateTransformer:e.updateTransformer},null,8,["tfData","onUpdateTransformer"])):(0,a.kq)("",!0),i.deleteEnable?((0,a.wg)(),(0,a.j4)(x,{key:1,onClick:i=>e.deleteField(l),style:{position:"absolute",right:"0",top:"23px",color:"#1890ff"}},null,8,["onClick"])):(0,a.kq)("",!0)])))),128))])]),(0,a._)("div",v,[(0,a._)("div",_,["MAPPING"===e.type&&e.fieldMap.sinkDS.length>0?((0,a.wg)(),(0,a.j4)(T,{key:0,dataSource:e.fieldMap.sinkDS,columns:e.columns2,size:"large",pagination:!1,bordered:""},{fieldName:(0,a.w5)((i=>{var l=i.record;return[(0,a.Wm)(w,{disabled:!l.fieldEditable,ref:"select",value:l.fieldName,style:{width:"150px"},options:l.fieldOptions,onChange:i=>e.updateSinkFieldName(l,i)},null,8,["disabled","value","options","onChange"])]})),fieldType:(0,a.w5)((e=>{var i=e.record;return[(0,a.Wm)(N,{value:i.fieldType,style:{width:"150px"},disabled:""},null,8,["value"])]})),_:1},8,["dataSource","columns"])):(0,a.kq)("",!0)])])])],2),[[t.vShow,e.isFold]])])])}l(41539),l(88674),l(54747),l(57327),l(40561);var S=l(74670),g=l(42255),D=l(92487),b=l(94638);const w=(0,a.aZ)({props:{fmData:Object,fieldsSource:Array,fieldsSink:Array,deductions:Array,addEnabled:Boolean,engineType:String},emits:["updateFieldMap"],components:{Transformer:(0,a.RC)((()=>l.e(776).then(l.bind(l,78776)))),DeleteOutlined:g.Z,RightOutlined:D.Z,DownOutlined:b.Z},setup(e,i){var l=e.fmData.type,d=(0,S.qj)({sourceDS:[],sinkDS:[],transformerList:[]}),t=(0,a.Fl)((()=>JSON.parse(JSON.stringify(e.fmData))));(0,a.YP)(t,((e,i)=>{var l="string"===typeof e?JSON.parse(e):e;y.value=!!(0,S.IU)(l).mapping.length,o((0,S.IU)(l).mapping||[])}));var r=(0,a.Fl)((()=>JSON.parse(JSON.stringify(e.deductions))));(0,a.YP)(r,((i,l)=>{i&&(y.value=!!(0,S.IU)(e.fmData.mapping).length),o((0,S.IU)(e.fmData.mapping)||[])}));var s=e=>{var i=[];if(e){var l=(0,S.IU)(e);l.forEach((e=>{var l={};l.value=e.name,l.label=e.name,l.type=e.type,i.push(l)}))}return i},n=(i,l,a)=>{var d=[];i.forEach((e=>{var i={},t=e.key;l.forEach((e=>{e.key==t&&(i.sink_field_name=e.fieldName,i.sink_field_type=e.fieldType,i.sink_field_index=e.fieldIndex,i.sink_field_editable=e.fieldEditable)})),a.forEach((e=>{e.key==t&&(i.validator=e.validator,i.transformer=e.transformer,i.deleteEnable=e.deleteEnable)})),i.source_field_name=e.fieldName,i.source_field_type=e.fieldType,i.source_field_index=e.fieldIndex,i.source_field_editable=e.fieldEditable,d.push(i)}));var t=e.fmData,r=t.type,s=t.sql;return{type:r,mapping:d,sql:s}},o=i=>{d.sourceDS=[],d.sinkDS=[],d.transformerList=[],"object"===typeof i&&i.forEach(((i,l)=>{var a={},t={},r={};if(i.source_field_name&&i.source_field_type)a.key=l+"",a.fieldName=i.source_field_name&&i.source_field_name,a.fieldOptions=s(e.fieldsSource),a.fieldType=i.source_field_type&&i.source_field_type,a.fieldIndex=i.source_field_index,a.fieldEditable=i.source_field_editable,t.key=l+"",t.fieldName=i.sink_field_name&&i.sink_field_name,t.fieldOptions=s(e.fieldsSink),t.fieldType=i.sink_field_type&&i.sink_field_type,t.fieldIndex=i.sink_field_index,t.fieldEditable=i.sink_field_editable,r.key=l+"",r.validator=i.validator&&i.validator,r.transformer=i.transformer&&i.transformer,r.deleteEnable=i.deleteEnable,d.transformerList.push(r),d.sourceDS.push(a),d.sinkDS.push(t);else if(i.source&&i.source.name&&i.source.type){var n={},o={},f={};n.key=l+"",n.fieldName=i.source.name,n.fieldOptions=s(e.fieldsSource),n.fieldType=i.source.type,n.fieldIndex=i.source.fieldIndex,n.fieldEditable=i.source.fieldEditable,o.key=l+"",o.fieldName=i.sink.name,o.fieldOptions=s(e.fieldsSink),o.fieldType=i.sink.type,o.fieldIndex=i.sink.fieldIndex,o.fieldEditable=i.sink.fieldEditable,f.key=l+"",f.validator=[],f.transformer={},f.deleteEnable=i.deleteEnable,d.transformerList.push(f),d.sourceDS.push(n),d.sinkDS.push(o)}}))};o((0,S.IU)(e.fmData).mapping||[]),console.log("sourceDS",d);var f=e=>{var l=d.transformerList.filter((i=>i.key!=e.key));l.push(e),d.transformerList=l;var a=n(d.sourceDS,d.sinkDS,d.transformerList);i.emit("updateFieldMap",a)},p=(e,l)=>{var a=e.key,t=e.fieldOptions;d.sourceDS.forEach((e=>{if(e.key==a)return e.fieldName=l,void t.forEach((i=>{i.value===e.fieldName&&(e.fieldType=i.type)}))}));var r=n(d.sourceDS,d.sinkDS,d.transformerList);i.emit("updateFieldMap",r)},u=(e,l)=>{var a=e.key,t=e.fieldOptions;d.sinkDS.forEach((e=>{if(e.key==a)return e.fieldName=l,void t.forEach((i=>{i.value===e.fieldName&&(e.fieldType=i.type)}))}));var r=n(d.sourceDS,d.sinkDS,d.transformerList);i.emit("updateFieldMap",r)},c=()=>{var i=d.sourceDS.length,l=d.sinkDS.length,a=d.transformerList.length,t={},r={},n={};t.key=i+"",t.fieldName="",t.fieldOptions=s(e.fieldsSource),t.fieldType="",t.fieldEditable=!0,r.key=l+"",r.fieldName="",r.fieldOptions=s(e.fieldsSink),r.fieldType="",r.fieldEditable=!0,n.key=a+"",n.validator=[],n.transformer={},n.deleteEnable=!0,d.transformerList.push(n),d.sourceDS.push(t),d.sinkDS.push(r)},m=e=>{d.transformerList.splice(e,1),d.sourceDS.splice(e,1),d.sinkDS.splice(e,1);var l=n(d.sourceDS,d.sinkDS,d.transformerList);i.emit("updateFieldMap",l)},y=(0,S.iH)(!1),k=()=>{y.value=!y.value};return{type:l,fieldMap:d,columns1:[{title:"来源字段",children:[{title:"字段名",dataIndex:"fieldName",key:"fieldName",slots:{customRender:"fieldName"}},{title:"类型",dataIndex:"fieldType",key:"fieldType",slots:{customRender:"fieldType"}}]}],columns2:[{title:"目的字段",children:[{title:"字段名",dataIndex:"fieldName",key:"fieldName",slots:{customRender:"fieldName"}},{title:"类型",dataIndex:"fieldType",key:"fieldType",slots:{customRender:"fieldType"}}]}],updateTransformer:f,updateSourceFieldName:p,updateSinkFieldName:u,addTableRow:c,isFold:y,showInfo:k,deleteField:m}}});var N=l(53629);const T=(0,N.Z)(w,[["render",h],["__scopeId","data-v-5da9c90c"]]),E=T}}]);