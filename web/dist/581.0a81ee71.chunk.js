"use strict";(self["webpackChunk_fesjs_template"]=self["webpackChunk_fesjs_template"]||[]).push([[581],{41581:(e,t,r)=>{r.r(t),r.d(t,{default:()=>I});r(66992),r(33948),r(21249);var a=r(1089),n=r(91706),l=r(56485),s=e=>((0,a.dD)("data-v-51c61c5c"),e=e(),(0,a.Cn)(),e),c={class:"sds-wrap"},i={key:1,class:"sds-title-tags"},u=["title"],o={key:0},p={key:1},d={class:"sds-wrap-t"},h=s((()=>(0,a._)("span",null,"数据类型",-1))),f=s((()=>(0,a._)("span",null,"数据源",-1))),v=s((()=>(0,a._)("span",null,"搜索库",-1))),w=s((()=>(0,a._)("span",null,"搜索表",-1))),g={class:"sds-wrap-b"};function b(e,t,r,s,b,S){var x=(0,a.up)("PlusOutlined"),y=(0,a.up)("a-select"),m=(0,a.up)("a-space"),k=(0,a.up)("a-input"),D=(0,a.up)("a-spin"),O=(0,a.up)("a-directory-tree"),q=(0,a.up)("a-modal");return(0,a.wg)(),(0,a.iD)("div",c,["请点击后选择"===e.defaultSelect?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"sds-button",onClick:t[0]||(t[0]=function(){return e.showModal&&e.showModal(...arguments)})},[(0,a.Wm)(x,{style:{color:"rgba(0, 0, 0, 0.65)","font-size":"12px","margin-right":"8px"}}),(0,a._)("span",null,(0,n.zw)(e.defaultSelect),1)])):((0,a.wg)(),(0,a.iD)("div",i,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.defaultSelect,((r,l)=>((0,a.wg)(),(0,a.iD)("div",{class:"sds-title-tag",key:l,onClick:t[1]||(t[1]=function(){return e.showModal&&e.showModal(...arguments)}),title:r},[0===l?((0,a.wg)(),(0,a.iD)("span",o,[(0,a._)("span",{class:"logo",style:(0,n.j5)(e.getBg())},null,4),(0,a.Uk)(" "+(0,n.zw)(r),1)])):((0,a.wg)(),(0,a.iD)("span",p,(0,n.zw)(r),1))],8,u)))),128))])),(0,a.Wm)(q,{visible:e.visible,"onUpdate:visible":t[9]||(t[9]=t=>e.visible=t),title:"选择数据源",onOk:e.handleOk,width:"500px"},{default:(0,a.w5)((()=>[(0,a._)("div",d,[(0,a.Wm)(m,{size:"middle"},{default:(0,a.w5)((()=>[h,(0,a.Wm)(y,{value:e.curSql,"onUpdate:value":t[2]||(t[2]=t=>e.curSql=t),style:{width:"150px"},placeholder:"请先选择数据库",options:e.sqlList.map((e=>({value:e.value,label:e.name}))),onChange:e.handleChangeSql},null,8,["value","options","onChange"]),f,(0,a.Wm)(y,{placeholder:"请先选择数据源",style:{width:"150px"},value:e.dataSource,"onUpdate:value":t[3]||(t[3]=t=>e.dataSource=t),onChange:e.handleChangeDS,options:e.dataSourceList.map((e=>({value:e.value,label:e.name})))},null,8,["value","onChange","options"])])),_:1}),e.dataSource?((0,a.wg)(),(0,a.j4)(m,{key:0,size:"middle"},{default:(0,a.w5)((()=>[v,(0,a.Wm)(k,{placeholder:"按回车搜库",style:{width:"300px","margin-top":"10px","margin-left":"14px"},value:e.searchDB,"onUpdate:value":t[4]||(t[4]=t=>e.searchDB=t),onKeyup:t[5]||(t[5]=(0,l.withKeys)((t=>{e.showTableSearch=!1,e.createTree(e.dsId)}),["enter"]))},null,8,["value"])])),_:1})):(0,a.kq)("",!0),e.dataSource&&e.showTableSearch?((0,a.wg)(),(0,a.j4)(m,{key:1,size:"middle"},{default:(0,a.w5)((()=>[w,(0,a.Wm)(k,{placeholder:"按回车搜表",style:{width:"300px","margin-top":"10px","margin-left":"14px"},value:e.searchWord,"onUpdate:value":t[6]||(t[6]=t=>e.searchWord=t),onKeyup:t[7]||(t[7]=(0,l.withKeys)((t=>e.filterTree(e.dsId)),["enter"]))},null,8,["value"])])),_:1})):(0,a.kq)("",!0)]),(0,a._)("div",g,[(0,a.Wm)(D,{spinning:e.spinning,style:{"text-align":"center",width:"100%",height:"300px","padding-top":"150px"}},null,8,["spinning"]),(0,a.Wm)(O,{height:400,"tree-data":e.treeData,autoExpandParent:!1,expandedKeys:e.expandedKeys,"onUpdate:expandedKeys":t[8]||(t[8]=t=>e.expandedKeys=t),onSelect:e.selectItem,onExpand:e.handleExpandSql},null,8,["tree-data","expandedKeys","onSelect","onExpand"])])])),_:1},8,["visible","onOk"])])}r(82526),r(49337);var S=r(4942),x=(r(86778),r(25318)),y=r(15861),m=r(87757),k=r.n(m),D=(r(41539),r(54747),r(57327),r(74916),r(24603),r(39714),r(92222),r(47042),r(23123),r(63467)),O=r(74775),q=r(23746),j=r(74670);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){(0,S.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const W=(0,a.aZ)({props:{title:[Object,String]},components:{PlusOutlined:D.Z,MinusOutlined:O.Z},emits:["updateDsInfo"],setup(e,t){var n,l,s,c=[],i=(0,j.iH)([]),u=(0,j.qj)({sqlSource:c.length?c[0].value:"",sqlList:c,defaultSelect:e.title,treeData:l,originTreeData:s,sqlId:"",dsId:"",curSql:"",dataSource:"",dataSourceList:[],selectTable:"",searchWord:"",searchDB:""}),o=(0,j.iH)(!1),p=(0,a.Fl)((()=>JSON.parse(JSON.stringify(e.title))));function d(){return h.apply(this,arguments)}function h(){return h=(0,y.Z)(k().mark((function e(){return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,q.TF)();case 2:if(n=e.sent.list,n.forEach((e=>{c.push({name:e.name,value:e.name,id:e.id})})),!u.sqlSource){e.next=7;break}return e.next=7,b(u.sqlSource);case 7:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}(0,a.YP)(p,((e,t)=>{u.defaultSelect=e})),(0,a.bv)(d());var f=function(){var e=(0,y.Z)(k().mark((function e(t){var r,a,n,l;return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={name:"",typeId:t,page:1,pageSize:1e3},a=[],e.prev=2,e.next=5,(0,q.f6)(r);case 5:n=e.sent,l=n.list,l.forEach((e=>{var t=Object.create(null);t.name=e.name,t.value=e.id,a.push(t)})),e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),console.log("err");case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t){return e.apply(this,arguments)}}(),v=(0,j.iH)(!1),w=function(){var e=(0,y.Z)(k().mark((function e(t){var r,a;return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u.curSql=t,r=u.sqlList.filter((e=>e.value===t))[0],u.sqlId=r.id,e.next=5,f(r.id);case 5:a=e.sent,u.dataSourceList=a.length>0?a:[],u.dataSource="",u.dsId="",u.searchWord="",u.searchDB="",u.treeData=[],u.originTreeData=[],v.value=!1;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,y.Z)(k().mark((function e(t){return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:u.searchWord="",u.searchDB="",v.value=!1,b(t,(()=>{var e=u.dataSourceList.filter((e=>e.value===t))[0];u.dataSource=e.name,u.dsId=e.value}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=(0,y.Z)(k().mark((function e(t,r){var a,n,l;return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return o.value=!0,a=[],n=u.dataSourceList.filter((e=>e.value===t))[0],e.prev=5,e.next=8,(0,q.dl)(u.curSql,n.value);case 8:l=e.sent.dbs,e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](5),l=[],console.log(e.t0);case 15:if(u.searchDB&&(l=l.filter((e=>new RegExp(u.searchDB).test(e))),v.value=!0),l){e.next=18;break}return e.abrupt("return");case 18:l.forEach(((e,t)=>{var r=Object.create(null);r.selectable=!1,r.title=e,r.key=e,r.children=[],a.push(r)})),u.treeData=a,u.originTreeData=[].concat(a),o.value=!1,r&&r();case 23:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,r){return e.apply(this,arguments)}}(),S=e=>{if(!u.searchDB)return x.Z.error("请确定搜索的库");var t=(0,j.IU)(u.originTreeData);u.searchWord?u.treeData=t.map((e=>E(E({},e),{},{children:e.children.filter((e=>new RegExp(u.searchWord,"i").test(e.title)))}))):b(e)},m=(0,j.iH)(!1),D=()=>{m.value=!0},O=e=>{u.selectTable=e.join("")},T=()=>u.curSql?u.dataSource?u.selectTable?(u.defaultSelect="".concat(u.curSql,".").concat(u.dataSource,".").concat(u.selectTable),m.value=!1,t.emit("updateDsInfo",u.defaultSelect,u.dsId),u.curSql="",u.dataSource="",u.selectTable="",u.treeData=[],u.originTreeData=[],void(i.value=[])):x.Z.error("未正确选择库表"):x.Z.error("未正确选择数据源"):x.Z.error("未正确选择数据类型"),W=function(){var e=(0,y.Z)(k().mark((function e(t,r,a){var n,l;return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return l=[],e.next=3,(0,q.Lk)(t,r,a);case 3:if(e.t0=e.sent.tbs,e.t0){e.next=6;break}e.t0=[];case 6:return n=e.t0,n.forEach((e=>{var t=Object.create(null);t.title=e,t.key="".concat(a,".").concat(e),l.push(t)})),e.abrupt("return",l);case 9:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),Z=function(){var e=(0,y.Z)(k().mark((function e(t,r){var a,n,l,s;return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r.expanded,a=r.node,n=a.title,l=u.originTreeData.find((e=>e.title==n&&e.children.length>0)),l){e.next=9;break}return e.next=6,W(u.curSql,u.dsId,n);case 6:s=e.sent,u.treeData.forEach(function(){var e=(0,y.Z)(k().mark((function e(t){return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.title!==n){e.next=4;break}return u.searchWord&&(s=s.filter((e=>new RegExp(u.searchWord,"i").test(e.title)))),s.forEach((e=>{e.isLeaf=!0})),e.abrupt("return",t.children=s.slice());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),u.originTreeData.forEach(function(){var e=(0,y.Z)(k().mark((function e(t){return k().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.title!==n){e.next=3;break}return s.forEach((e=>{e.isLeaf=!0})),e.abrupt("return",t.children=s.slice());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),_=()=>{var e=u.curSql||("string"===typeof u.defaultSelect?u.defaultSelect.split(".")[0]:u.defaultSelect[0]);return"background-image: url(".concat(r(12077)("./"+e+".png"),")")};return E(E({},(0,j.BK)(u)),{},{selectItem:O,visible:m,showModal:D,handleOk:T,sqlList:c,handleChangeSql:w,handleExpandSql:Z,handleChangeDS:g,getBg:_,expandedKeys:i,createTree:b,filterTree:S,spinning:o,showTableSearch:v})}});var Z=r(53629);const _=(0,Z.Z)(W,[["render",b],["__scopeId","data-v-51c61c5c"]]),I=_}}]);